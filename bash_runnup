#!/bin/bash

# Variables
number_of_processes=2
#max_number=37
max_number=14

# Function to run python script with a subset of numbers
run_python_script() {
    python3 main.py "$@"
}

# Function to handle SIGINT (Ctrl-C)
cleanup() {
    echo "Terminating all background processes..."
    # Kill all background processes
    for pid in "${pids[@]}"; do
        kill "$pid" 2>/dev/null
    done
    wait
    exit 1
}

# Set up trap to catch SIGINT and call cleanup
trap cleanup SIGINT

# Calculate the step size
step_size=$((max_number / number_of_processes))

# Array to store process IDs
pids=()

# Loop through the numbers and run the script in parallel
for ((i=0; i<max_number; i+=step_size)); do
    args=()
    for ((j=0; j<step_size; j++)); do
        if ((i + j < max_number)); then
            args+=($((i + j)))
        fi
    done
    echo "a"
    echo "${args[@]}"
    run_python_script "${args[@]}" &
    pids+=($!)  # Store the process ID
done

# Wait for all background processes to finish
wait